var timeoutID,content,curMonthCounter,redoObj,year,month,theDate,editableLI,todayOrdinalCell,responseMonth,modalSource,modalContent,dateParts,$usr,userCompany,weeksDOM=document.querySelectorAll("div#weeks"),headerYr=document.getElementById("#headerYr"),originalContent="",newContent="";const appDateTime=new Date;var appDisplayDate=appDateTime.getMonth()+1+"/"+appDateTime.getDate()+"/"+appDateTime.getFullYear(),lastEditedCell=[],redo=[],changes=[],listElements=[],boxIDs=["t0","t1","t2","t3","t4","t5","t6","t7","t8","t9","t10"],monthName=["OccupyZeroPosition-PlaceHolder","January","February","March","April","May","June","July","August","September","October","November","December"],$icon='<i class="p1"></i><i class="p2"></i><i class="p3"></i><i class="p4"></i>',teamHTML="",historicUpdates={},pendingUpdates={},teamAssignment=[],assignLabels=[],iconSet={ups:"ic-ups",unassigned:"ic-flag",trip:"ic-i-ret-trip",crane:"ic-i-crane",crew:"ic-users",parts:"ic-cog",comp:"ic-i-comp-alt",inv:"ic-i-comp-inv",info:"ic-p-inf",inspr:"ic-p-insp-req",inspa:"ic-p-insp-appr",pappr:"ic-p-appr",prmt:"ic-asterisk"},iconAssignments={"Custom Sign Center":{1:"Will",2:"Ali",3:"Mary",4:"Marshall",5:"Jack",6:"SubInstall",7:"CSC Transp",8:"Shipping",9:"Cust PU",10:"UPS/ic-ups",11:"UnAssigned/ic-flag"},"Outdoor Images":{1:"Chad",2:"Marvin",3:"Shawn",4:null,5:"Pat",6:null,7:"Rec CSC Transp",8:"Rec Shipping",9:"Cust PU",10:"UPS/ic-ups",11:"UnAssigned/ic-flag"},"Marion Signs":{},"Boyer Signs":{},"JG Signs":{}},teamIconsDisplay="",justReloaded=0,overdueJobs=[],IDLE_TIMEOUT=900,_idleSecondsCounter=0;function BrowserDetection(){navigator.userAgent.indexOf("MSIE")>-1&&alert("Internet Explorer is NOT recommended for the Calendar. Install and Use FireFox or Chrome Instead.")}function clearAlert(){window.clearTimeout(timeoutID)}function wait(e){"start"==e?($("#wait").removeClass("hide"),setTimeout(function(){},500)):$("#wait").addClass("hide")}function updateTime(){formattedDateTime=new Date,$("#curTime").html(formattedDateTime.toLocaleTimeString("en-US"))}function recreateCheckboxListeners(){var e=$("#checkboxWrapper").find("input");e=$.merge(e,$("#second-chkbx-wrapper").find("input")),$(e).each(function(e,t){$(t).on("change",function(){var e=$(this).attr("name");$(this).attr("id");var t=RegExp(/^(?:ic-).*$/);if($(this).is(":checked")){if(!0===t.test(e))hideShowIconJob(e,!0);else for(var i=0;listElements.length>i;i++)$(listElements[i]).hasClass(e)&&$(listElements[i]).removeClass("hide")}else if(!0===t.test(e))hideShowIconJob(e,!1);else for(var n=0;listElements.length>n;n++)$(listElements[n]).hasClass(e)&&$(listElements[n]).addClass("hide")})})}function recreateEditJobsListeners(){var e=document.getElementsByClassName("edit");$.each(e,function(t,i){"undefined"!=typeof isAdmin&&(e[t].addEventListener("dblclick",startEdit,!0),bindListeners4EachList(i)),listsIntoObjects(i,t)})}function addListenersToDom(e){renewTeamIconCheckboxDispaly(),recreateEditJobsListeners(),recreateCheckboxListeners(),1===justReloaded&&(wait("start"),onloadSetOverdueDisplay(),wait("end"),justReloaded=1),"true"===e&&teamsShowAll()}function listsIntoObjects(e,t){var i=$(e).find("li");$(i).each(function(e,t){listElements.push(t)})}function CheckIdleTime(){_idleSecondsCounter++;var e=document.getElementById("SecondsUntilExpire");e&&(e.innerHTML=IDLE_TIMEOUT-_idleSecondsCounter+""),_idleSecondsCounter>=IDLE_TIMEOUT&&(confirm("You've been idle 15 mins.\nPlease click OK to continue session.\nTo close this session click Cancel.")?_idleSecondsCounter=0:document.location.href="login.php")}function loadCalendar(e,t,i){overdueJobs=[],$("#overdueJobsList").html(""),void 0===e&&(e=curCompany),wait("start");var n=new Date,o=n.getDate();t<0&&(t=n.getMonth()+1),i<0&&(i=n.getFullYear());var a={content:"",year:i,month:t,theDate:o,company:e,method:"display"};$.ajax({url:"classes/calendar.php",type:"POST",data:a,dataType:"json",success:function(e,t,i){wait("end"),theDate=e.theDate,year=e.year,curMonthCounter=month=e.activeMonthNumber,todayOrdinalCell=e.activeOrdinalCell,$("#weeks").html(e.html),toString(e.html),$("#yr").html(year),$("#yr").attr("ordinal",year),$("#mo").html(monthName[month]),$("#mo").attr("ordinal",month),userCompany=e.userCompany},error:function(e,t,i){wait("end")}}),timeoutID=window.setTimeout(addListenersToDom,300),justReloaded=1}function giveNotice(e){$("div#message").fadeIn("slow",function(){$("div#message").css("display","inherit"),$("div#message").css("padding","12px"),$("div#message").css("height","auto"),$("div#message").html("<p>"+e+"</p>")}).delay(1600).fadeOut("slow"),$("div#message").css("display","none"),$("div#message").css("padding","0px"),$("div#message").css("height","0px")}function clearCache(){caches.keys().then(e=>e.forEach(e=>caches.delete(e)))}function teamsShowAll(){if(!1!==$("#modal").is(":visible"))return!1;var e=$(".j").find("input");$(e).each(function(){$(this).prop("checked",!0)}),$(listElements).each(function(e,t){$(t).removeClass("hide")});var t=$("#teamSelection").find("input");$(t).each(function(e,t){$(t).prop("checked",!0)})}function teamsHideAll(){var e=$(".j").find("input");$(e).each(function(){$(this).prop("checked",!1),hideShowIconJob($(this).attr("name"),!1)}),$(listElements).each(function(e,t){$(t).parent().hasClass("edit")&&$(t).addClass("hide")});var t=$("#teamSelection").find("input");$(t).each(function(e,t){$(t).prop("checked",!1)})}function modalOpen(e,t){"undefined"!=typeof dragEditing&&(dragEditing="OFF"),hideSearchResult(),"undefined"!=typeof isAdmin&&$("#divContextMenu").is(":visible")&&($("#divContextMenu").remove(),$(document).find(".context-style").removeClass("context-style"));var i=$(e).closest(".month");if("day"===t){modalContent=$(e).parents(".date").children("ul");var n=$(i).attr("ordinal"),o=$(i).attr("yr");$(modalContent).attr("ordinal",n),$(modalContent).attr("yr",o);var a=$(modalContent).attr("modalid").replace("d","");"undefined"!=typeof isAdmin?$(modalContent).clone(!0,!0).appendTo("#modal"):$(modalContent).clone(!1,!1).appendTo("#modal"),$("#modal").prepend('<span class="cursive" style="float:right;font-size:17px;color:#8AC72D">'+n+"/"+a+"/"+o+"</span>")}else if("week"===t){modalContent=$(e).closest(".calRow");var s=$(i).attr("ordinal"),l=$(i).attr("yr"),r=$(e).attr("id")+" for "+s+" / "+l;r='<span class="cursive" style="float:right;font-size:17px;color:#8AC72D">'+r+"</span>",$("#modal").addClass("weekView"),$(modalContent).clone().appendTo("#modal"),$("#modal").prepend(r),$("#modal").css("width","95%"),$("#modal").css("height","auto"),$("#modal .dragImg").addClass("hide"),$("#modal .addNewLine").addClass("hide"),$("#modal .modalImg").each(function(){$(this).addClass("hide")})}$(".blocker").removeClass("hide"),$(".blocker").css("opacity",0).animate({opacity:1},10),addListenersToDom("false")}function modalClose(e){if("undefined"!=typeof dragEditing&&(dragEditing="ON",rearrangeJobs(e)),$("#modal").removeAttr("style"),$("#modal > span.cursive:first").remove(),$("#modal").find("li.context-style").first().removeClass("context-style"),"undefined"!=typeof isAdmin&&$("#divContextMenu").is(":visible")){alert("Close This Popup before Exiting.");return}if($("#modal").hasClass("weekView"))return $("#modal").find(".hide").each(function(){$(this).removeClass("hide")}),$("#modal").removeClass("weekView"),$("#modal > div.calRow:first").remove(),modalSource="",$(".blocker").addClass("hide"),!0;var t=$("#modal").children("ul.edit");$(t).attr("ordinal"),$(t).attr("yr"),$(t).attr("modalid"),"undefined"!=typeof isAdmin?$(modalContent).replaceWith($(t).clone(!0,!0)):$(modalContent).replaceWith($(t).clone(!1,!1)),$(t).remove(),modalSource="",$(".blocker").addClass("hide"),addListenersToDom("false")}function modalSave(e,t){"undefined"!=typeof isAdmin&&(e.html(t),$.each(e,function(t,i){e[t].addEventListener("click",startEdit,!0),"undefined"!=typeof isAdmin&&bindListeners4EachList(e)}))}function hideSearchResult(){$("#srchResult").is(":visible")&&($("#srchResult").empty(),$("#search").val(""),$("#srchResult").addClass("hide"))}function displayNewMonth(e){wait("start");var t=$(".month");if("next"===e){if(12>parseInt(month)){var i=String(parseInt(month)+1),n=monthHTMLexists(t,i,year);if("ok"!==n){giveNotice('<span style="color: #FF0000">There is No Job Data Stored for that Month.</span>'),wait("end");return}$(t).each(function(e,t){$(t).addClass("hide"),$(t).attr("ordinal")==i&&$(t).attr("yr")==String(year)&&($(t).removeClass("hide"),curMonthCounter=month=String(i),$("#mo").html(monthName[month]),$("#mo").attr("ordinal",month),$("#mo").removeClass("hide"))}),wait("end");return}var n=monthHTMLexists(t,"1",String(parseInt(year)+1));if("ok"!==n){giveNotice('<span style="color: #FF0000">There is No Job Data Stored for that Month.</span>'),wait("end");return}i="1",year=String(parseInt(year)+1),$(t).each(function(e,t){$(t).addClass("hide"),$(t).attr("ordinal")==i&&$(t).attr("yr")==String(year)&&($(t).removeClass("hide"),curMonthCounter=month=String(i),$("#mo").html(monthName[month]),$("#mo").attr("ordinal",month),$("#mo").removeClass("hide"),$("#yr").html(year),$("#yr").attr("ordinal",year))}),wait("end");return}if(parseInt(month)>1){var i=parseInt(month)-1,n=monthHTMLexists(t,i,year);if("ok"!==n){giveNotice('<span style="color: #FF0000">There is No Job Data Stored for that Month.</span>'),wait("end");return}$(t).each(function(e,t){$(t).addClass("hide"),$(t).attr("ordinal")==String(i)&&$(t).attr("yr")==String(year)&&($(t).removeClass("hide"),curMonthCounter=month,$("#mo").html(monthName[i]),$("#mo").attr("ordinal",i),$("#mo").removeClass("hide"))}),month=String(i)}else if(1==parseInt(month)){var o=parseInt(year)-1,n=monthHTMLexists(t,"12",o);if("ok"!==n){giveNotice('<span style="color: #FF0000">There is No Job Data Stored for that Month.</span>'),wait("end");return}var i="12";year=String(parseInt(year)-1),$(t).each(function(e,t){$(t).addClass("hide")}),$(t).each(function(e,t){$(t).attr("yr")==o&&$(t).attr("ordinal")==i&&($(t).removeClass("hide"),curMonthCounter=month=String(i),$("#mo").html(monthName[month]),$("#yr").html(year))})}wait("end");var a=addListenersToDom("false");window.setTimeout(a,100)}function monthHTMLexists(e,t,i){var n=!1;return t=String(t),$(e).each(function(e,o){$(o).attr("yr")===String(i)&&$(o).attr("ordinal")===String(t)&&(n="ok")}),n}function printAnyElement(e){$("#modal").clone().appendTo("#print"),$("#print").removeClass("hide"),$("#print").find("img").remove(),$("#print").find("button").remove();var t=window.open("","_blank","scrollbars=yes,resizable=yes,top=20,left=5,height=900,width=1200");t.document.write('<html><head><title>Print Request</title><link rel="stylesheet" href="https://customsigncenter.com/calendar/styles/bootstrap.min.css" media="all"><link href="https://customsigncenter.com/calendar/styles/print_1.css" media="print" rel="stylesheet" /> <link rel="stylesheet" href="https://customsigncenter.com/calendar/assets/icomoon/style.css">'),t.document.write('</head><body id="printBody" style="font-size:14px !important">'),t.document.write($("#print").html()),t.document.write("</body></html>"),t.document.close(),t.print(),$("#print").empty(),$("#print").addClass("hide"),$("#modal img.modalImg").removeClass("hide"),$("#modal button").removeClass("hide"),$("#modal .smBtn").removeClass("hide"),modalClose()}function cleanCalendarLayout(){$("#print").empty(),$("#pageTitle").clone().appendTo("#print"),$("span#date").clone().appendTo("#print"),$("span#curTime").clone().appendTo("#print"),$("#checkboxWrapper").clone().appendTo("#print"),$("span#mo").clone().appendTo("#print"),$("span#yr").clone().appendTo("#print"),$("#headerDays").clone().appendTo("#print"),$(".month").clone().appendTo("#print"),$("#print").find("img").remove(),$("#print").find("button").remove(),$("#print").find("input").remove()}function toggleVisibility(e){var t=$(e);t.hasClass("hide")?t.removeClass("hide"):t.addClass("hide")}function confirmRequest(e){return confirm(e)}function hideShowIconJob(e,t){var i=$("#calWrap").find("i."+e);!0===t?$(i).each(function(e,t){$(this).closest("li.lineEntry").removeClass("hide")}):$(i).each(function(e,t){$(this).closest("li.lineEntry").addClass("hide")})}function printWindow(){$("#print").removeClass("hide");var e=window.open("","","scrollbars=yes,resizable=yes,top=20,left=5,height=900,width=1200");e.document.write('<html><head><title>Print Calendar</title><link rel="stylesheet" href="/calendar/styles/bootstrap.min.css" media="all"><link href="/calendar/styles/print_1.css" media="print" rel="stylesheet" /> <link rel="stylesheet" href="/calendar/assets/icomoon/style.css">');var t=$("#print").find(".edit");return $(t).each(function(e,t){$(t).find("li").length<1&&$(t).parent(".date").attr("style","border:none")}),$(["#headerDays",".calRow","#teams",".row"]).each(function(e,t){$("#print "+t).addClass("clearfix")}),e.document.write('</head><body id="printBody">'),e.document.write($("#print").html()),e.document.write("</body></html>"),e.document.close(),setTimeout(function(){e.print()},500),$("#print").html(""),$("#print").addClass("hide"),!1}function onloadSetOverdueDisplay(){overdueJobs=[];let e=document.getElementById("OverDueJobsList");e.innerHTML="",wait("start");var t=$("#weeks").find("li.due");wait("end");let i=[];if($.each(t,function(e,t){var n=$(this).children("span").first().text();if(!i.includes(n)){i.push(n);var o=$(this).closest("ul").attr("modalid").substr(1),a=$(t).closest(".month").attr("ordinal"),s=$(t).closest(".month").attr("yr"),l=new Date(s+"-"+a+"-"+o),r=document.createElement("span");r.setAttribute("style","color: red"),r.innerHTML=a+"/"+o+"/"+s;var d=$(this).text().slice(0,30),c=document.createElement("div");c.append(r),c.innerHTML+=d,c.className="ovrDue",c.id=n,overdueJobs.push({markup:c,dueDate:l,jobNmbr:n})}}),overdueJobs.length>0){$("#overdueJobsList").html("");let n=overdueJobs.sort((e,t)=>t.dueDate>e.dueDate?1:-1);for(var o=0;o<n.length;o++)n[o].hasOwnProperty("markup")&&null!==n[o].markup&&e.append(n[o].markup)}else $("#overdueJobsList").html("<p>Excellent! All WIPs are On-Schedule.</p>")}function isEmpty(e){if(null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}if("Array"==e.constructor.name)return!(e.length>0)}function renewTeamIconCheckboxDispaly(){teamIconsDisplay='<div class="row"><span style="padding-top:12px;float:left; clear:left">Assignment: &nbsp;</span>',$.each(iconAssignments[curCompany],function(e,t){if(null!==t){if(10>parseInt(e,10)){let i="";7==e&&(i="<br/>"),teamIconsDisplay+=i+i+'<div class="iconrow"><input style="float:left" type="checkbox" id="select-'+e+'" name="t'+e+'" value="'+e+'" checked="checked"><div class="box-label t'+e+'" id="l'+e+'"><li id="t'+e+'" class="t'+e+'" onclick="jobAssignment('+e+', this)" option="'+e+'">'+t+"</li></div></div>"}else{var n=t.split("/");teamIconsDisplay+='<div class="iconrow"><input style="float:left" type="checkbox" id="select-'+e+'" name="'+n[1]+'" value="'+n[0].toLowerCase()+'" checked="checked"><div class="box-label" id="l'+e+'"><li id="'+n[0].toLowerCase()+'" class="t'+e+'" onclick="jobAssignment(\''+n[0].toLowerCase()+'\', this)" option="'+n[0].toLowerCase()+'">&nbsp;<i class="'+n[1]+'"></i>'+n[0]+"</li><!--1--></div><!--2--></div>"}}}),teamIconsDisplay+='</div><div class="j row"><span style="padding-top:12px;float:left; color:#0d58a1;">Job Status: &nbsp;</span><div class="iconrow"><input style="float:left" type="checkbox" id="select-12" name="ic-i-ret-trip" value="t12" checked="checked"><div class="box-label" id="l12"><li id="ic-i-ret-trip" onclick="jobAssignment(\'trip\', this)" option="trip"><i class="ic-i-ret-trip"></i> Service</li></div></div><div class="iconrow"><div class="box-label" id="l13"><li id="13" onclick="jobAssignment(\'crew\', this)" option="crew"><i class="ic-users"></i> 2-Man</li></div></div><div class="iconrow"><div class="box-label" id="l14"><li id="14" onclick="jobAssignment(\'crane\', this)" option="crane"><i class="ic-i-crane ic-i-comp"></i> 100ft Crane</li></div></div><div class="iconrow"><div class="box-label" id="l15"><li id="15" onclick="jobAssignment(\'parts\', this)" option="parts"> <i class="ic-cog"></i> Part Needed</li></div></div><div class="iconrow"><input style="float:left" type="checkbox" id="select-16" name="ic-i-comp-alt" value="t16" checked="checked"><div class="box-label" id="l16"><li id="16" onclick="jobAssignment(\'comp\', this)" option="comp"><i class="ic-i-comp-alt"></i> Ready to Invoice</li></div></div><div class="iconrow"><input style="float:left" type="checkbox" id="select-17" name="ic-i-comp-inv" value="t17" checked="checked"><div class="box-label" id="l17"><li id="17" onclick="jobAssignment(\'inv\', this)" option="inv"><i class="ic-i-comp-inv"></i> Collect</li></div></div></div>',teamIconsDisplay+='</div><div class="p row"><span style="padding-top:12px;float:left;color:#0f8040">Permit Status: </span><div class="iconrow"><div class="box-label" id="l18"><li id="18" onclick="jobAssignment(\'info\', this)" option="info"><i class="ic-p-inf"></i> Need Info</li></div></div><div class="iconrow"><div class="box-label" id="l19"><li id="19" onclick="jobAssignment(\'inspr\', this)" option="inspr"><i class="ic-p-insp-req"></i> Insp. Req\'ed</li></div></div><div class="iconrow"><div class="box-label" id="l20"><li id="20" onclick="jobAssignment(\'inspa\', this)" option="inspa"><i class="ic-p-insp-appr"></i> Insp. Appr\'d</li></div></div><div class="iconrow"><div class="box-label" id="l21"><li id="21" onclick="jobAssignment(\'pappr\', this)" option="pappr" title="Prmt Completed or Not Required"><i class="ic-p-appr"></i> Done/Not Needed</li></div></div><div class="iconrow"><input style="float:left" type="checkbox" id="select-22" name="ic-asterisk" value="t22" checked="checked"><div class="box-label" id="l22"><li id="22" onclick="jobAssignment(\'prmt\', this)" option="prmt"><i class="ic-asterisk"></i> Prmt Only</li></div></div></div>',$("#teams").html(""),$("#teams").html(teamIconsDisplay)}function changeCompanyCalendar(){justReloaded=1,curCompany=$("#companyCalendar option:selected").val(),$("#pageTitle").html(curCompany+" WIP Calendar"),"function"==typeof teamNamesHTML&&teamNamesHTML(),loadCalendar(curCompany,-1,-1)}$(document).ready(function(){$usr=$("#username").text(),$("#weeks .calRow"),document.onkeypress=function(){_idleSecondsCounter=0},document.onclick=function(){_idleSecondsCounter=0},document.onmousemove=function(){_idleSecondsCounter=0},window.setInterval(CheckIdleTime,2e3),$("#companyCalendar").on("change",function(){changeCompanyCalendar()}),loadCalendar(curCompany=$("#companyCalendar option:selected").val(),-1,-1),$("#pageTitle").html(curCompany+" WIP Calendar"),$("#btnPrev").on("click",function(){displayNewMonth("prev")}),$("#btnNext").on("click",function(){displayNewMonth("next")}),$("#btnPrint").on("click",function(){cleanCalendarLayout(),printWindow()}),$("button#tglUserList").click(function(){$("#authenticatedUserList").slideToggle("slow")}),justReloaded=1,timeoutID=window.setTimeout(addListenersToDom,1100),$("#date").html(appDisplayDate)}),updateTime(),setInterval(updateTime,1e3),$("#search").on("input",function(){var e=$(this).val().toLowerCase(),t=[],i=[];e.length>2?($("li.lineEntry").each(function(n,o){if(void 0!==o)var a=$(this).text().toLowerCase().trim();-1===a.indexOf(e)||(i.push(o),t.push(a))}),i.length>0?($("#srchResult").removeClass("hide"),$("#srchResult").empty(),document.createElement("br"),$(i).each(function(e,t){var i=$(t).parent(".edit").attr("modalid");if(void 0!==i&&i.length>1){i=i.replace("d","");var n=$(t).closest("div.month").attr("ordinal"),o=$(t).closest("div.month").attr("yr");i=n+"/"+i+"/"+o}void 0!==t&&($("#srchResult").append("<div style='cursor:pointer' class='result"+e+"'  >Date: "+i+", "+$(t).html()+"</div>"),$(document.body).find(".result"+e).on("click",function(){$(t).addClass("context-style"),modalOpen(t,"day")}))})):hideSearchResult()):($("#srchResult").removeClass("hide"),$("#srchResult").html("[ Search Requires 3+ Characters. ]"))}),$("#srchResult").parent("form").on("focusout",function(){$(".blocker").hasClass(".hide")&&(hideSearchResult(),$("#srchResult").empty())});